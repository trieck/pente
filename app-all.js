/*
Copyright(c) 2014 Rieck Enterprises
*/
Ext.define("Pente.model.Piece",{extend:"Ext.data.Model",statics:{PT_PLAYER_ONE:1,PT_PLAYER_TWO:2,PT_PLAYER_ONE_DEFAULT_COLOR:"008000",PT_PLAYER_TWO_DEFAULT_COLOR:"800000"},fields:[{name:"key",type:"int"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"who",type:"int"}]});Ext.define("Pente.view.BoardComponent",{extend:"Ext.draw.Component",alias:"widget.board-component",uses:["Pente.lib.Board","Pente.model.Piece"],viewBox:false,items:[],initComponent:function(){var h=Pente.lib.Board;var g=h.dimensions();var c=h.squareSize;var b=h.squareSize;var f=h.cxBorder;var e=h.cyBorder;var a,d;var k,i;this.items.push({type:"rect",id:"pente-board",width:h.width(),height:h.height(),fill:"#fff0d4",stroke:"#c0c0c0",x:h.cxBorder,y:h.cyBorder});a=Ext.create("Ext.util.Point",f+c,e);while(a.x<g.right){d=Ext.create("Ext.util.Point",a.x,g.bottom+e);k=Ext.String.format("M{0} {1} L{2} {3}",a.x,a.y,d.x,d.y);i={type:"path",path:k,stroke:"#c0c0c0","stroke-width":0.5};this.items.push(i);a.x+=c}a=Ext.create("Ext.util.Point",f,e+b);while(a.y<g.bottom){d=Ext.create("Ext.util.Point",g.right+f,a.y);k=Ext.String.format("M{0} {1} L{2} {3}",a.x,a.y,d.x,d.y);i={type:"path",path:k,stroke:"#c0c0c0","stroke-width":0.5};this.items.push(i);a.y+=b}g=Pente.lib.Board.boundingRect();var j=g.getSize();this.height=j.height;this.width=j.width;this.playerOnePieces=Ext.create("Ext.draw.CompositeSprite",{surface:this});this.playerTwoPieces=Ext.create("Ext.draw.CompositeSprite",{surface:this});this.callParent(arguments)},drawPiece:function(i,b){var h=Pente.model.Piece;var g=Pente.lib.Board;var a=g.cxPiece/2;var d=this.getOrigin({x:i.data.x,y:i.data.y});var c=Ext.String.format("#{0}",b);var f=this.surface.add({type:"circle",fill:c,stroke:"#000000","stroke-width":1,opacity:1,radius:a,x:d.x,y:d.y});var e=g.key(i.data.x,i.data.y);if(i.data.who===h.PT_PLAYER_ONE){this.playerOnePieces.add(e,f)}else{this.playerTwoPieces.add(e,f)}f.show(true)},removePiece:function(d){var a=Pente.lib.Board;var c=a.key(d.x,d.y);var b=this.playerOnePieces.get(c);if(b){this.playerOnePieces.remove(b);this.surface.remove(b,true)}else{if((b=this.playerTwoPieces.get(c))){this.playerTwoPieces.remove(b);this.surface.remove(b,true)}}},getOrigin:function(d){var c=Pente.lib.Board;var b=c.mapPoint(d.x,d.y);var a=b.x+(c.cxPiece/2);var e=b.y+(c.cyPiece/2);return{x:a,y:e}},setBoardColor:function(a){Ext.fly("pente-board").setStyle("fill",a)},setGridColor:function(b){var a=Ext.query("path");var d=a.length;for(var c=0;c<d;++c){Ext.fly(a[c]).setStyle("stroke",b)}},setPlayerOneColor:function(a){var b=Ext.String.format("#{0}",a);this.playerOnePieces.setAttributes({fill:b},true)},setPlayerTwoColor:function(a){var b=Ext.String.format("#{0}",a);this.playerTwoPieces.setAttributes({fill:b},true)}});Ext.define("Pente.lib.MapStore",{extend:"Ext.data.AbstractStore",alias:"store.mapstore",requires:["Ext.data.StoreManager","Ext.data.Model"],uses:["Ext.ModelManager"],statics:{recordIdFn:function(a){return a.data.key}},constructor:function(a){a=Ext.apply({},a);var b=this;b.callParent([a]);b.data=new Ext.util.MixedCollection({getKey:Pente.lib.MapStore.recordIdFn});if(b.autoLoad){Ext.defer(b.load,1,b,[typeof b.autoLoad==="object"?b.autoLoad:undefined])}},add:function(a){var c=this,b;b=a;if(!b.isModel){b=c.createModel(b)}b=c.data.add(b);c.fireEvent("add",c,[b],0);c.fireEvent("datachanged",c);if(c.autoSync&&!c.autoSyncSuspended){c.sync()}return b},get:function(a){var b=this;return b.data.map[a]},createModel:function(a){if(!a.isModel){a=Ext.ModelManager.create(a,this.model,a.key);a.phantom=true}return a},getNewRecords:function(){return this.data.filterBy(this.filterNew).items},getUpdatedRecords:function(){return this.data.filterBy(this.filterUpdated).items},load:function(a){var b=this;a=a||{};if(typeof a=="function"){a={callback:a}}return b.callParent([a])},onProxyLoad:function(b){var d=this,c=b.getResultSet(),a=b.getRecords(),e=b.wasSuccessful();if(d.isDestroyed){return}if(c){d.totalCount=c.total}d.loading=false;if(e){d.loadRecords(a,b)}if(d.hasListeners.load){d.fireEvent("load",d,a,e)}},removeAll:function(a){var b=this;b.remove({start:0,end:b.getCount()-1},a);if(a!==true){b.fireEvent("clear",b)}},remove:function(g,n){var o=this,e,j,m,k,d,p,h=o.data,a,b,c=[],l=[],f=!n&&o.hasListeners.remove;if(g.isModel){g=[g];d=1}else{if(Ext.isIterable(g)){d=g.length}else{if(typeof g==="object"){a=true;j=g.start;d=g.end+1;b=d-j}}}for(;j<d;j++){if(a){k=h.getAt(j);m=j}else{k=g[j];m=o.indexOf(k)}e=k.phantom!==true;k.unjoin(o);p=p||e;c.push(k);l.push(m);if(!a){h.removeAt(m);if(f){o.fireEvent("remove",o,k,m,false)}}}if(a){h.removeRange(g.start,b)}if(!n){o.fireEvent("bulkremove",o,c,l,false);o.fireEvent("datachanged",o)}if(o.autoSync&&p&&!o.autoSyncSuspended){o.sync()}},getCount:function(){return this.data.getCount()},loadRecords:function(a,b){var f=this,c=0,e=a.length,g,d;if(b){g=b.start;d=b.addRecords}if(!d){f.clearData(true)}f.data.addAll(a);if(g!==undefined){for(;c<e;c++){a[c].index=g+c;a[c].join(f)}}else{for(;c<e;c++){a[c].join(f)}}f.fireEvent("datachanged",f);f.fireEvent("refresh",f)}});Ext.define("Pente.model.BoardState",{extend:"Ext.data.Model",fields:[{name:"who",type:"int"},{name:"table-color",type:"string"},{name:"board-color",type:"string"},{name:"grid-color",type:"string"},{name:"player-one-color",type:"string"},{name:"player-two-color",type:"string"}]});Ext.define("Pente.view.View",{extend:"Ext.panel.Panel",alias:"widget.pente-view",bodyStyle:"background-color:#503200;",requires:["Pente.view.BoardComponent"],items:[{xtype:"board-component"}],initComponent:function(){var b=Pente.lib.Board.boundingRect();var a=b.getSize();this.height=a.height;this.width=a.width;this.callParent(arguments)},drawPiece:function(b,a){var c=this.query("board-component")[0];c.drawPiece(b,a)},removePiece:function(b){var a=this.query("board-component")[0];a.removePiece(b)},setColor:function(a){this.setBodyStyle("background-color",a)},setBoardColor:function(a){var b=this.query("board-component")[0];b.setBoardColor(a)},setGridColor:function(a){var b=this.query("board-component")[0];b.setGridColor(a)},setPlayerOneColor:function(a){var b=this.query("board-component")[0];b.setPlayerOneColor(a)},setPlayerTwoColor:function(a){var b=this.query("board-component")[0];b.setPlayerTwoColor(a)}});Ext.define("Pente.store.PieceStore",{extend:"Pente.lib.MapStore",model:"Pente.model.Piece",uses:"Pente.lib.Board",autoSync:true,autoLoad:false,proxy:{type:"sessionstorage",id:"PieceKey",reader:{model:"Pente.model.Piece"}},getByPoint:function(b){var a=Pente.lib.Board.key(b.x,b.y);return this.get(a)},removeAll:function(){this.callParent(arguments);this.proxy.clear();this.proxy.initialize()},who:function(b){var a=this.getByPoint(b);if(a){return a.data.who}}});Ext.define("Pente.store.BoardStateStore",{extend:"Ext.data.Store",model:"Pente.model.BoardState",uses:"Pente.model.Piece",autoSync:true,autoLoad:false,proxy:{type:"sessionstorage",id:"BoardStateKey",reader:{model:"Pente.model.BoardState"}},changeTurns:function(){var b=Pente.model.Piece;var a=this.getRecord();a.data.who=a.data.who===b.PT_PLAYER_ONE?b.PT_PLAYER_TWO:b.PT_PLAYER_ONE;a.dirty=true;this.sync()},who:function(){var a=this.getRecord();return a.data.who},setTurn:function(b){var a=this.getRecord();a.data.who=b;a.dirty=true;this.sync()},setTableColor:function(b){var a=this.getRecord();a.data["table-color"]=b;a.dirty=true;this.sync()},setBoardColor:function(b){var a=this.getRecord();a.data["board-color"]=b;a.dirty=true;this.sync()},setGridColor:function(b){var a=this.getRecord();a.data["grid-color"]=b;a.dirty=true;this.sync()},setPlayerOneColor:function(b){var a=this.getRecord();a.data["player-one-color"]=b;a.dirty=true;this.sync()},setPlayerTwoColor:function(b){var a=this.getRecord();a.data["player-two-color"]=b;a.dirty=true;this.sync()},tableColor:function(){var a=this.getRecord();return a.data["table-color"]},boardColor:function(){var a=this.getRecord();return a.data["board-color"]},gridColor:function(){var a=this.getRecord();return a.data["grid-color"]},playerOneColor:function(){var a=this.getRecord();return a.data["player-one-color"]},playerTwoColor:function(){var a=this.getRecord();return a.data["player-two-color"]},getRecord:function(){var b=Pente.model.Piece;var a=this.getAt(0);if(!a){a=this.add({who:b.PT_PLAYER_ONE})[0]}return a},removeAll:function(){this.callParent(arguments);this.proxy.clear();this.proxy.initialize()},empty:function(){return this.getCount()===0}});Ext.define("Pente.controller.Controller",{extend:"Ext.app.Controller",models:["Pente.model.Piece"],stores:["Pente.store.PieceStore","Pente.store.BoardStateStore"],views:["Pente.view.View"],uses:["Pente.lib.Machine"],refs:[{selector:"pente-view",ref:"penteView"}],init:function(){var a=this.getPenteStoreBoardStateStoreStore();a.on("load",this.onStoreLoadBoard,this);a=this.getPenteStorePieceStoreStore();a.on("load",this.onStoreLoadPieces,this);a.on("add",this.onStoreAddPieces,this);a.on("bulkremove",this.onStoreBulkRemovePieces,this);this.control({"pente-view":{afterrender:this.onViewAfterRender},"pente-toolbar > button#newButton":{click:this.onNewGame},"#table-picker":{select:this.onTableColor},"#board-picker":{select:this.onBoardColor},"#grid-picker":{select:this.onGridColor},"#player-one-picker":{select:this.onPlayerOneColor},"#player-two-picker":{select:this.onPlayerTwoColor}})},onLaunch:function(){this.machine=Ext.create("Pente.lib.Machine")},onViewAfterRender:function(a){var b=this.getPenteStoreBoardStateStoreStore();b.load();b=this.getPenteStorePieceStoreStore();b.load();a.body.on("click",Ext.bind(this.onClicked,this))},onClicked:function(f){var d=f.browserEvent;var c=Pente.lib.Board;var a=d.offsetX?d.offsetX:d.layerX;var g=d.offsetY?d.offsetY:d.layerY;var b=c.ptOnBoard(a,g);if(b){if(this.addPoint(a,g)){this.machineMove()}}},addPoint:function(a,f){var c=Pente.lib.Board;var b=this.getPenteStorePieceStoreStore();var e=c.getSquare(a,f);var d=this.getPiece(e.x,e.y);if(!b.get(d.key)){return this.addPiece(d)}return false},machineMove:function(){var b=this.machine.move(),a;if(b){a=this.getPiece(b.x,b.y);this.addPiece(a)}},addPiece:function(b){var a=this.getPenteStorePieceStoreStore();a.add(b);this.changeTurns();return !this.checkWinner()},checkWinner:function(){var a=Pente.model.Piece;var b=this.machine.winner();var c;if(b){c=b===a.PT_PLAYER_ONE?"Player One":"Player Two";Ext.MessageBox.alert("Game Over!",c+" Wins!",function(){this.onNewGame()},this)}return b},changeTurns:function(){var a=this.getPenteStoreBoardStateStoreStore();a.changeTurns()},getPiece:function(a,d){var b=this.getPenteStoreBoardStateStoreStore();var c=Pente.lib.Board.key(a,d);return{key:c,x:a,y:d,who:b.who()}},onStoreLoadPieces:function(b,a,d,c){this.addToView(a)},onStoreAddPieces:function(b,a,c,d){this.addToView(a)},onStoreBulkRemovePieces:function(g,a,c,h,e){var f=this.getPenteView();var d=a.length;for(var b=0;b<d;++b){var j=a[b];f.removePiece({x:j.data.x,y:j.data.y})}},addToView:function(d){var b=this.getPenteView();var a=d.length;var f,c;for(var e=0;e<a;++e){f=d[e];c=this.getPieceColor(f);b.drawPiece(d[e],c)}},getPieceColor:function(c){var b=this.getPenteStoreBoardStateStoreStore();var d=Pente.model.Piece;var a;if(c.data.who===d.PT_PLAYER_ONE){if(b.empty()){a=d.PT_PLAYER_ONE_DEFAULT_COLOR}else{a=b.playerOneColor();a=a.length?a:d.PT_PLAYER_ONE_DEFAULT_COLOR}}else{if(b.empty()){a=d.PT_PLAYER_TWO_DEFAULT_COLOR}else{a=b.playerTwoColor();a=a.length?a:d.PT_PLAYER_TWO_DEFAULT_COLOR}}return a},onNewGame:function(){var b=Pente.model.Piece;var a=this.getPenteStorePieceStoreStore();a.removeAll();a=this.getPenteStoreBoardStateStoreStore();a.setTurn(b.PT_PLAYER_ONE)},onTableColor:function(d,c,e){var b=this.getPenteStoreBoardStateStoreStore();var a=this.getPenteView();a.setColor(c);b.setTableColor(c)},onBoardColor:function(d,c,e){var b=this.getPenteStoreBoardStateStoreStore();var a=this.getPenteView();a.setBoardColor(c);b.setBoardColor(c)},onGridColor:function(d,c,e){var b=this.getPenteStoreBoardStateStoreStore();var a=this.getPenteView();a.setGridColor(c);b.setGridColor(c)},onPlayerOneColor:function(d,c,e){var b=this.getPenteStoreBoardStateStoreStore();var a=this.getPenteView();a.setPlayerOneColor(c);b.setPlayerOneColor(c)},onPlayerTwoColor:function(d,c,e){var b=this.getPenteStoreBoardStateStoreStore();var a=this.getPenteView();a.setPlayerTwoColor(c);b.setPlayerTwoColor(c)},onStoreLoadBoard:function(c,b,f,d){var a=this.getPenteView();var e;if(f&&b.length>0){e=b[0].data["table-color"];if(e.length){a.setColor(e)}e=b[0].data["board-color"];if(e.length){a.setBoardColor(e)}e=b[0].data["grid-color"];if(e.length){a.setGridColor(e)}e=b[0].data["player-one-color"];if(e.length){a.setPlayerOneColor(e)}e=b[0].data["player-two-color"];if(e.length){a.setPlayerTwoColor(e)}}}});Ext.define("Pente.lib.Board",{statics:{boardSize:19,cxPiece:18,cyPiece:18,cxBorder:20,cyBorder:20,cxOffset:2,cyOffset:2,cxSquares:18,cySquares:18,squareSize:21,width:function(){return this.squareSize*this.cxSquares},height:function(){return this.squareSize*this.cySquares},entries:function(){return this.boardSize*this.boardSize},dimensions:function(){var b=this.width();var a=this.height();return new Ext.util.Region(0,b,a,0)},boundingRect:function(){var a=this.dimensions();a.right+=this.cxBorder*2;a.bottom+=this.cyBorder*2;return a},ptOnBoard:function(a,c){var b=this.dimensions().copy();b.adjust(-(this.cyPiece/2),this.cxPiece/2,this.cyPiece/2,-(this.cxPiece/2));b.adjust(this.cyBorder,this.cyBorder,this.cyBorder,this.cxBorder);return !!(a>=b.x&&c>=b.y&&a<b.right&&c<b.bottom)},getSquare:function(a,d){var c=Ext.create("Ext.util.Point",a,d);c.x-=(this.cxBorder-(this.cxPiece/2));c.y-=(this.cyBorder-(this.cyPiece/2));var b=Ext.create("Ext.util.Point");b.x=parseInt(Math.min(Math.max(0,(c.x/this.squareSize)),this.cxSquares),10);b.y=parseInt(Math.min(Math.max(0,(c.y/this.squareSize)),this.cySquares),10);return b},mapPoint:function(a,b){a=Math.min(Math.max(0,a),this.cxSquares);b=Math.min(Math.max(0,b),this.cySquares);a=(this.cxBorder-(this.cxPiece/2))+(a*this.squareSize);b=(this.cyBorder-(this.cyPiece/2))+(b*this.squareSize);return Ext.create("Ext.util.Point",a,b)},key:function(a,b){return(b%this.boardSize)*this.boardSize+(a%this.boardSize)}}});Ext.define("Pente.lib.Machine",{requires:["Pente.lib.Board"],vectors:[],statics:{VSIZE:5,MIN_WEIGHT:-Number.MIN_VALUE,MAX_WEIGHT:Number.MAX_VALUE,PIECE_WEIGHT:1,CONT_WEIGHT:0.5,CENTER:180,MEAN_POINT:2},constructor:function(){this.pieceStore=Ext.getStore("Pente.store.PieceStore");this.boardStateStore=Ext.getStore("Pente.store.BoardStateStore");this.generate()},generate:function(){var f,e,b,g,d=[];var c=Pente.lib.Board;var a=c.entries();for(f=0;f<a;++f){b=Math.floor(f/c.boardSize);g=f%c.boardSize;if(this.self.VSIZE+g<=c.boardSize){d=[];for(e=0;e<this.self.VSIZE;++e){d.push({x:b,y:g+e})}this.vectors.push(d)}if(this.self.VSIZE+b<=c.boardSize){d=[];for(e=0;e<this.self.VSIZE;++e){d.push({x:b+e,y:g})}this.vectors.push(d)}if(this.self.VSIZE+b<=c.boardSize&&this.self.VSIZE+g<=c.boardSize){d=[];for(e=0;e<this.self.VSIZE;++e){d.push({x:b+e,y:g+e})}this.vectors.push(d)}if(b>=this.self.VSIZE-1&&this.self.VSIZE+g<=c.boardSize){d=[];for(e=0;e<this.self.VSIZE;++e){d.push({x:b-e,y:g+e})}this.vectors.push(d)}}},move:function(){var f=Pente.model.Piece;var b,e=this.self.MIN_WEIGHT;var a,h=this.vectors.length;var j,c;var g=this.boardStateStore.who();if(g!==f.PT_PLAYER_TWO){return false}for(var d=0;d<h;++d){b=this.weightVector(this.vectors[d]);if(b>e){e=b;a=this.vectors[d]}}c=this.mustBlock();if(!c&&e===this.self.MIN_WEIGHT){if(!(j=this.blockMove())){j=this.randomMove()}}if(c&&e<this.self.MAX_WEIGHT){j=c}else{if(a){j=this.bestMove(a)}}return j},mustBlock:function(){var a;if((a=this.matchBlock(4,1))){return a}a=this.matchBlock(3,2);return a},matchBlock:function(o,k){var h=0,f=this.self.MIN_WEIGHT,q=this.vectors.length;var e,c,a,n;var g=[],m;var l=Pente.model.Piece;var b,r,d;for(e=0;e<q;++e){g=[];for(c=0,b=0,r=0;c<this.self.VSIZE;++c){a=this.vectors[e][c];n=this.pieceStore.who(a);if(!n){g.push(a);r++}else{if(n===l.PT_PLAYER_ONE){b++}}}if(b===o&&r===k){m=g.length;for(c=0;c<m;++c){h=this.weightPoint(g[c]);if(h>f){d={x:g[c].x,y:g[c].y};f=h}}}}return d},blockMove:function(){var b,d,c,a;if(!(a=this.maxOpponentV())){return false}for(b=0;b<this.self.VSIZE;++b){d=a[b];c=this.pieceStore.who(d);if(!c){return d}}},randomMove:function(){var b=this.emptySet();var a=b.length,c;if(a>0){c=Math.floor(Math.random()*(b.length-1));return b[c]}},emptySet:function(){var a=Pente.lib.Board;var c,b,d,e=[];for(c=0;c<a.boardSize;++c){for(b=0;b<a.boardSize;++b){d=this.pieceStore.who({x:c,y:b});if(!d){e.push({x:c,y:b})}}}return e},weightVector:function(l){var o=Pente.lib.Board;var f=Pente.model.Piece;var e=0;var k,c,b,a,j,h,g,p;for(c=0;c<this.self.VSIZE;++c){k=this.pieceStore.who(l[c]);if(!k){continue}switch(k){case f.PT_PLAYER_ONE:return this.self.MIN_WEIGHT;case f.PT_PLAYER_TWO:e+=this.self.PIECE_WEIGHT;break}}if(e===(this.self.VSIZE-1)*this.self.PIECE_WEIGHT){return this.self.MAX_WEIGHT}for(c=0;c<this.self.VSIZE;++c){k=this.pieceStore.who(l[c]);if(!k){continue}if(k===f.PT_PLAYER_TWO){e+=this.weightPoint(l[c])}}p=l[this.self.MEAN_POINT];b=p.x;a=p.y;j=Math.floor(this.self.CENTER/o.boardSize);h=this.self.CENTER%o.boardSize;g=Math.abs(Math.floor(j-b))+Math.abs(Math.floor(h-a))+1;e+=1/g;e+=this.self.CONT_WEIGHT*this.contiguity(l);return e},weightPoint:function(g){var e=0,b,a=this.vectors.length,d,c,f;if(this.pieceStore.who(g)){return this.self.MIN_WEIGHT}for(d=0;d<a;++d){for(c=0;c<this.self.VSIZE;++c){f=this.vectors[d][c];if(this.isEqualPoint(f,g)){break}}if(c<this.self.VSIZE){b=this.weightVector(this.vectors[d]);e+=Math.max(0,b)}}return e},isEqualPoint:function(b,a){return b.x===a.x&&b.y===a.y},contiguity:function(b){var d=Pente.model.Piece;var a=0,f=0,c,e;for(c=0;c<this.self.VSIZE;++c){e=this.pieceStore.who(b[c]);if(!e){a=0}else{if(e===d.PT_PLAYER_TWO){if(++a>f){f=a}}}}return f},bestMove:function(c){var e,h,f;var b=Pente.lib.Board;var d=Pente.model.Piece;var g,a=this.self.MIN_WEIGHT;if(this.center(c)){h={x:Math.floor(this.self.CENTER/b.boardSize),y:this.self.CENTER%b.boardSize};return h}for(e=0;e<this.self.VSIZE;++e){h=c[e];if(e<this.self.VSIZE-1&&this.pieceStore.who(h)===d.PT_PLAYER_TWO){h=c[e+1];if(!this.pieceStore.who(h)){if((g=this.weightPoint(h))>a){a=g;f={x:h.x,y:h.y}}}}if(e>0&&this.pieceStore.who(h)===d.PT_PLAYER_TWO){h=c[e-1];if(!this.pieceStore.who(h)){if((g=this.weightPoint(h))>a){a=g;f={x:h.x,y:h.y}}}}}if(f){return f}for(e=0;e<this.self.VSIZE;++e){h=c[e];if(!this.pieceStore.who(h)){if((g=this.weightPoint(h))>a){a=g;f={x:h.x,y:h.y}}}}return f},center:function(b){var c,e,f,d;var a=Pente.lib.Board;for(c=0;c<this.self.VSIZE;++c){e=b[c];f=e.x*a.boardSize+e.y;d=this.pieceStore.who(e);if((f===this.self.CENTER)&&!d){return true}}return false},maxOpponentV:function(){var e=Pente.model.Piece;var d,c,f,h,g,b=this.self.MIN_WEIGHT,a=this.vectors.length;for(d=0;d<a;++d){for(c=0,g=0;c<this.self.VSIZE;++c){f=this.pieceStore.who(this.vectors[d][c]);if(f===e.PT_PLAYER_ONE){g+=e.PIECE_WEIGHT}else{if(f===e.PT_PLAYER_TWO){break}}}if(g>b){b=g;h=this.vectors[d]}}return h},winner:function(){var e,c,a=this.vectors.length;var d=Pente.model.Piece;var g,f;var h,b;for(e=0;e<a;++e){for(c=0,h=0,b=0;c<this.self.VSIZE;++c){g=this.vectors[e][c];f=this.pieceStore.who(g);if(!f){continue}if(f===d.PT_PLAYER_ONE){h++}if(f===d.PT_PLAYER_TWO){b++}}if(h===this.self.VSIZE){return d.PT_PLAYER_ONE}if(b===this.self.VSIZE){return d.PT_PLAYER_TWO}}}});Ext.define("Pente.lib.StatusBar",{extend:"Ext.toolbar.Toolbar",alias:"widget.statusbar",requires:["Ext.toolbar.TextItem"],cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&#160;",activeThreadId:0,initComponent:function(){var a=this.statusAlign==="right";this.callParent(arguments);this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=Ext.create("Ext.toolbar.TextItem",{cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(a){this.cls+=" x-status-right";this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}},setStatus:function(e){var a=this;e=e||{};Ext.suspendLayouts();if(Ext.isString(e)){e={text:e}}if(e.text!==undefined){a.setText(e.text)}if(e.iconCls!==undefined){a.setIcon(e.iconCls)}if(e.clear){var f=e.clear,d=a.autoClear,b={useDefaults:true,anim:true};if(Ext.isObject(f)){f=Ext.applyIf(f,b);if(f.wait){d=f.wait}}else{if(Ext.isNumber(f)){d=f;f=b}else{if(Ext.isBoolean(f)){f=b}}}f.threadId=this.activeThreadId;Ext.defer(a.clearStatus,d,a,[f])}Ext.resumeLayouts(true);return a},clearStatus:function(e){e=e||{};var c=this,b=c.statusEl;if(e.threadId&&e.threadId!==c.activeThreadId){return c}var d=e.useDefaults?c.defaultText:c.emptyText,a=e.useDefaults?(c.defaultIconCls?c.defaultIconCls:""):"";if(e.anim){b.el.puff({remove:false,useDisplay:true,callback:function(){b.el.show();c.setStatus({text:d,iconCls:a})}})}else{c.setStatus({text:d,iconCls:a})}return c},setText:function(b){var a=this;a.activeThreadId++;a.text=b||"";if(a.rendered){a.statusEl.setText(a.text)}return a},getText:function(){return this.text},setIcon:function(a){var b=this;b.activeThreadId++;a=a||"";if(b.rendered){if(b.currIconCls){b.statusEl.removeCls(b.currIconCls);b.currIconCls=null}if(a.length>0){b.statusEl.addCls(a);b.currIconCls=a}}else{b.currIconCls=a}return b},showBusy:function(a){if(Ext.isString(a)){a={text:a}}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a)}});Ext.define("Pente.lib.Statuspanel",{extend:"Ext.panel.Panel",alias:"widget.pente-statuspanel",require:"Ext.lib.StatusBar",bbar:Ext.create("Pente.lib.StatusBar",{id:"pente-status",defaultText:"Default status text",defaultIconCls:"default-icon",text:"Ready",iconCls:"ready-icon"})});Ext.define("Pente.lib.ColorPicker",{extend:"Ext.picker.Color",alias:"widget.pente-colorpicker",colors:["000000","800000","008000","808000","000080","800080","008080","C0C0C0","C0DCC0","A6CAF0","FFF0D4","FFE2B1","FFD48E","FFC66B","FFB848","FFAA25","FFAA00","DC9200","B97A00","966200","734A00","503200","FFE3D4","FFC7B1","FFAB8E","FF8F6B","FF7348","FF5725","FF5500","DC4900","B93D00","963100","732500","501900","FFD4D4","FFB1B1","FF8E8E","FF6B6B","FF4848","FF2525","FF0000","DC0000","B90000","960000","730000","500000","FFD4E3","FFB1C7","FF8EAB","FF6B8F","FF4873","FF2557","FF0055","DC0049","B9003D","960031","730025","500019","FFD4F0","FFB1E2","FF8ED4","FF6BC6","FF48B8","FF25AA","FF00AA","DC0092","B9007A","960062","73004A","500032","FFD4FF","FFB1FF","FF8EFF","FF6BFF","FF48FF","FF25FF","FF00FF","DC00DC","B900B9","960096","730073","500050","F0D4FF","E2B1FF","D48EFF","C66BFF","B848FF","AA25FF","AA00FF","9200DC","7A00B9","620096","4A0073","320050","E3D4FF","C7B1FF","AB8EFF","8F6BFF","7348FF","5725FF","5500FF","4900DC","3D00B9","310096","250073","190050","D4D4FF","B1B1FF","8E8EFF","6B6BFF","4848FF","2525FF","0000FF","0000DC","0000B9","000096","000073","000050","D4E3FF","B1C7FF","8EABFF","6B8FFF","4873FF","2557FF","0055FF","0049DC","003DB9","003196","002573","001950","D4F0FF","B1E2FF","8ED4FF","6BC6FF","48B8FF","25AAFF","00AAFF","0092DC","007AB9","006296","004A73","003250","D4FFFF","B1FFFF","8EFFFF","6BFFFF","48FFFF","25FFFF","00FFFF","00DCDC","00B9B9","009696","007373","005050","D4FFF0","B1FFE2","8EFFD4","6BFFC6","48FFB8","25FFAA","00FFAA","00DC92","00B97A","009662","00734A","005032","D4FFE3","B1FFC7","8EFFAB","6BFF8F","48FF73","25FF57","00FF55","00DC49","00B93D","009631","007325","005019","D4FFD4","B1FFB1","8EFF8E","6BFF6B","48FF48","25FF25","00FF00","00DC00","00B900","009600","007300","005000","E3FFD4","C7FFB1","ABFF8E","8FFF6B","73FF48","57FF25","55FF00","49DC00","3DB900","319600","257300","195000","F0FFD4","E2FFB1","D4FF8E","C6FF6B","B8FF48","AAFF25","AAFF00","92DC00","7AB900","629600","4A7300","325000","FFFFD4","FFFFB1","FFFF8E","FFFF6B","FFFF48","FFFF25","FFFF00","DCDC00","B9B900","969600","737300","505000","F2F2F2","E6E6E6","DADADA","CECECE","C2C2C2","B6B6B6","AAAAAA","9E9E9E","929292","868686","7A7A7A","6E6E6E","626262","565656","4A4A4A","3E3E3E","323232","262626","1A1A1A","0E0E0E","FFFBF0","A0A0A4","808080","FF0000","00FF00","FFFF00","0000FF","FF00FF","00FFFF","FFFFFF"]});Ext.define("Pente.lib.Toolbar",{extend:"Ext.Toolbar",alias:"widget.pente-toolbar",requires:["Pente.lib.ColorPicker"],items:[{xtype:"button",tooltip:{text:"Play a new game",title:"New Game"},text:"New Game",iconCls:"new",focusCls:"",id:"newButton"},{xtype:"button",tooltip:{text:"Change game settings",title:"Settings"},text:"Settings",iconCls:"gear",focusCls:"",id:"settingsButton",menu:{items:[{text:"Table Color",iconCls:"colors",menu:{plain:true,items:[{xtype:"pente-colorpicker",id:"table-picker"}]}},{text:"Board Color",iconCls:"colors",menu:{plain:true,items:[{xtype:"pente-colorpicker",id:"board-picker"}]}},{text:"Grid Color",iconCls:"colors",menu:{plain:true,items:[{xtype:"pente-colorpicker",id:"grid-picker"}]}},{text:"Player One Color",iconCls:"colors",menu:{plain:true,items:[{xtype:"pente-colorpicker",id:"player-one-picker"}]}},{text:"Player Two Color",iconCls:"colors",menu:{plain:true,items:[{xtype:"pente-colorpicker",id:"player-two-picker"}]}}]}},{xtype:"button",tooltip:{text:"About Pente for ExtJS",title:"About"},text:"About Pente",iconCls:"help",focusCls:"",id:"helpButton"}],initComponent:function(){Ext.QuickTips.init();Ext.tip.Tip.prototype.minWidth=150;this.callParent(arguments)}});Ext.define("Pente.lib.Frame",{extend:"Ext.window.Window",requires:["Pente.lib.Toolbar","Pente.lib.Statuspanel"],alias:"pente-frame",frame:true,closable:false,title:"Pente for ExtJS",border:true,items:[{xtype:"pente-view"}],dockedItems:[{xtype:"pente-toolbar"}],bbar:{xtype:"pente-statuspanel"},resizable:false});Ext.application({name:"Pente",appFolder:"app",controllers:["Controller"],uses:"Pente.lib.Frame",launch:function(){Ext.create("pente-frame").show()}});
